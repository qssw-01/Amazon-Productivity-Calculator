<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫öÈ©¨ÈÄäËøêËê•ÂàÜÊûêËÆ°ÁÆóÂô®</title>
    <style>
        :root { 
            --primary-color: #2c3e50; 
            --secondary-color: #3b82f6; 
            --success-color: #10b981; 
        }
        body { 
            font-family: 'Segoe UI', system-ui; 
            background: #f8f9fa; 
            margin: 0; 
            padding: 20px; 
        }
        .container { 
            max-width: 1400px;
            margin: 20px auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            position: relative;
        }
        h1 {
            flex: 1;
            text-align: center;
            color: var(--primary-color);
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 15px;
            margin: 0 20px;
        }
        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .export-btn {
            background: var(--secondary-color);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .export-btn:hover {
            opacity: 0.9;
        }
        .input-section { 
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        @media (max-width: 1200px) {
            .input-section { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 768px) {
            .input-section { grid-template-columns: 1fr; }
        }
        .input-group { 
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-color);
            min-width: 0;
        }
        #productInfo label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }
        #productInfo input {
            width: 100%;
            margin-top: 8px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
            color: #666;
        }
        .input-group:not(#productInfo) > label { 
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 14px;
        }
        .input-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 8px;
        }
        .input-label {
            font-size: 13px;
            color: var(--primary-color);
            white-space: nowrap;
            margin-right: 10px;
        }
        .input-group:not(#productInfo) input, 
        .input-group:not(#productInfo) select { 
            width: 120px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
        }
        .results-container { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .result-card { 
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-top: 4px solid var(--secondary-color);
            min-height: 300px;
        }
        .result-card h3 { 
            color: var(--primary-color);
            margin: 0 0 15px 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .result-item { 
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .result-item:last-child { border-bottom: none; }
        .label { 
            color: #7f8c8d;
            font-weight: 500;
            min-width: 160px;
        }
        .value { 
            color: var(--primary-color);
            font-weight: 600;
            text-align: right;
            position: relative;
            cursor: help;
        }
        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s;
            pointer-events: none;
            font-weight: 400;
            line-height: 1.4;
            max-width: 220px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .value:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
                .metric-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafe 100%);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(238, 242, 247, 0.8);
            position: relative;
            overflow: hidden;
        }
        .metric-card::before {
            content: "";
            position: absolute;
            top: -50px;
            right: -50px;
            width: 100px;
            height: 100px;
            background: rgba(52, 152, 219, 0.08);
            border-radius: 50%;
        }
        .metric-title {
            color: #64748b;
            font-size: 14px;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .metric-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: baseline;
            gap: 8px;
        }
        .value-unit {
            font-size: 16px;
            color: #94a3b8;
            font-weight: 500;
        }
        .trend-indicator {
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
        }
        .trend-up { color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .trend-down { color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        .mini-chart {
            height: 80px;
            margin: 15px -25px -25px;
            position: relative;
        }
        .donut-chart {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(var(--fill-color) 0% var(--fill-percent), #e2e8f0 0);
        }
        .donut-inner {
            position: absolute;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            top: 10px;
            left: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--primary-color);
        }
        .mini-bars {
            display: flex;
            align-items: flex-end;
            height: 100%;
            gap: 8px;
            padding: 0 15px;
        }
        .mini-bar {
            width: 20px;
            background: var(--secondary-color);
            border-radius: 4px 4px 0 0;
            transition: height 0.3s ease;
        }
        input {
            background: white !important;
            color: #666 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-container">
            <div class="header-controls">
                <div class="exchange-rate-group">
                    <span class="exchange-rate-label">üí∞ Ê±áÁéá (CNY/USD):</span>
                    <input type="number" id="exchangeRate" value="7" step="0.01" required>
                </div>
                <button class="export-btn" onclick="saveAsHTML()">‰øùÂ≠ò</button>
            </div>
            <div style="display: flex; align-items: center; gap: 15px; justify-content: center; flex: 1;">
                <h1>‰∫öÈ©¨ÈÄäÊäï‰∫ßÊØîÂàÜÊûêËÆ°ÁÆóÂô®</h1>
                <img src="https://raw.githubusercontent.com/qssw-01/Amazon-Productivity-Calculator/refs/heads/main/amazon.png" 
                     style="height: 40px; width: auto; margin-bottom: 8px;">
            </div>
        </div>

        <div class="input-section">
            <div class="input-group" id="productInfo">
                <label>üì¶ ‰∫ßÂìÅ‰ø°ÊÅØ</label>
                <input type="text" id="productName" placeholder="‰∫ßÂìÅÂêçÁß∞">
                <input type="text" id="amazonLink" placeholder="‰∫öÈ©¨ÈÄäÈìæÊé•">
                <input type="text" id="link1688" placeholder="1688ÈìæÊé•">
            </div>

            <div class="input-group">
                <label>üìà ÈîÄÂîÆÊï∞ÊçÆ</label>
                <div class="input-row">
                    <span class="input-label">ÊúàÈîÄÈáè</span>
                    <input type="number" id="monthlySales" value="600" required>
                </div>
                <div class="input-row">
                    <span class="input-label">ÊêúÁ¥¢ËΩ¨ÂåñÁéá (%)</span>
                    <input type="number" id="searchConversion" value="5" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">ÈÄÄË¥ßÁéá (%)</span>
                    <input type="number" id="returnRate" value="1.8" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">ÈîÄÂîÆ‰ª∑Ê†º ($)</span>
                    <input type="number" id="salesPrice" value="35" step="0.1" required>
                </div>
            </div>

            <div class="input-group">
                <label>üßÆ ÊàêÊú¨ËÆ°ÁÆó</label>
                <div class="input-row">
                    <span class="input-label">ÈááË¥≠ÊàêÊú¨ (Ôø•)</span>
                    <input type="number" id="purchaseCostCNY" value="65" required>
                </div>
                <div class="input-row">
                    <span class="input-label">‰∫ßÂìÅÈáçÈáè (kg)</span>
                    <input type="number" id="weight" value="1.3" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">Áâ©ÊµÅÊñπÂºè</span>
                    <select id="shippingMethod">
                        <option value="Á©∫Ëøê">Á©∫Ëøê</option>
                        <option value="Êµ∑Ëøê" selected>Êµ∑Ëøê</option>
                    </select>
                </div>
                <div class="input-row">
                    <span class="input-label">Áâ©ÊµÅÂçï‰ª∑ (Ôø•/kg)</span>
                    <input type="number" id="shippingPrice" value="7" required>
                </div>
            </div>
                        <div class="input-group">
                <label>‚öôÔ∏è Ë¥πÁî®ËÆæÁΩÆ</label>
                <div class="input-row">
                    <span class="input-label">FBAÁâ©ÊµÅË¥π ($)</span>
                    <input type="number" id="fbaFee" value="7.03" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">‰Ω£Èáë (%)</span>
                    <input type="number" id="commission" value="15" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">ÈÖçÁΩÆË¥π ($)</span>
                    <input type="number" id="configFee" value="0.34" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">‰ªìÂÇ®Ë¥π ($)</span>
                    <input type="number" id="storageFee" value="0.55" step="0.1" required>
                </div>
            </div>

            <div class="input-group">
                <label>üè¶ ËµÑÈáëËÆæÁΩÆ</label>
                <div class="input-row">
                    <span class="input-label">ÂπøÂëäÂç†ÊØî (%)</span>
                    <input type="number" id="adRate" value="10" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">ÂéãË¥ßÂ§©Êï∞</span>
                    <input type="number" id="stockDays" value="120" required>
                </div>
                <div class="input-row">
                    <span class="input-label">Ë¥¶ÊúüÂ§©Êï∞</span>
                    <input type="number" id="accountPeriod" value="">
                </div>
                <div class="input-row">
                    <span class="input-label">ÊèêÁé∞Âë®Êúü</span>
                    <input type="number" id="withdrawPeriod" value="15">
                </div>
            </div>
        </div>

        <div class="results-container" id="results"></div>
        <div class="dashboard" id="dashboard"></div>
    </div>
        <script>
        function calculate() {
            try {
                const getValue = id => parseFloat(document.getElementById(id).value) || 0;
                
                const inputs = {
                    exchangeRate: getValue('exchangeRate'),
                    monthlySales: getValue('monthlySales'),
                    searchConversion: getValue('searchConversion') / 100,
                    returnRate: getValue('returnRate') / 100,
                    salesPrice: getValue('salesPrice'),
                    purchaseCostCNY: getValue('purchaseCostCNY'),
                    weight: getValue('weight'),
                    shippingPrice: getValue('shippingPrice'),
                    fbaFee: getValue('fbaFee'),
                    commission: getValue('commission') / 100,
                    configFee: getValue('configFee'),
                    storageFee: getValue('storageFee'),
                    adRate: getValue('adRate') / 100,
                    stockDays: getValue('stockDays'),
                    accountPeriod: getValue('accountPeriod'),
                    withdrawPeriod: getValue('withdrawPeriod')
                };

                const shippingCostCNY = inputs.weight * inputs.shippingPrice;
                const purchaseCostUSD = inputs.purchaseCostCNY / inputs.exchangeRate;
                const shippingCostUSD = shippingCostCNY / inputs.exchangeRate;
                const commission = inputs.salesPrice * inputs.commission;
                const returnFee = inputs.salesPrice * inputs.returnRate;
                const adFee = inputs.salesPrice * inputs.adRate;

                const platformRefund = inputs.salesPrice - commission - inputs.configFee 
                    - inputs.storageFee - returnFee - adFee - inputs.fbaFee;
                const platformRefundCNY = platformRefund * inputs.exchangeRate;
                const profitUSD = platformRefund - purchaseCostUSD - shippingCostUSD;
                const profitCNY = profitUSD * inputs.exchangeRate;
                const profitRate = profitUSD / inputs.salesPrice;

                const monthlyRevenueUSD = inputs.monthlySales * inputs.salesPrice;
                const monthlyRevenueCNY = monthlyRevenueUSD * inputs.exchangeRate;
                const monthlyProfitCNY = (profitCNY * inputs.monthlySales) / 10000;
                const annualProfitCNY = monthlyProfitCNY * 12;

                const totalCostCNY = inputs.purchaseCostCNY + shippingCostCNY;
                const costReturnRatio = profitCNY / totalCostCNY;
                const dailySales = inputs.monthlySales / 30;
                const stockQuantity = dailySales * inputs.stockDays;
                const stockCostCNY = (stockQuantity * totalCostCNY) / 10000;
                const cashCycle = inputs.stockDays - (inputs.accountPeriod || 0) + (inputs.withdrawPeriod || 0);
                const capitalOccupiedCNY = (cashCycle * dailySales * totalCostCNY) / 10000;
                const annualROI = annualProfitCNY / capitalOccupiedCNY;
                const paybackDays = (stockCostCNY / annualProfitCNY) * 365;

                const resultCards = [
                    {
                        title: 'üì¶ ÊàêÊú¨ÊòéÁªÜ',
                        items: [
                            { label: 'ÈááË¥≠ÊàêÊú¨ (Ôø•)', value: inputs.purchaseCostCNY.toFixed(2), tooltip: '‰∫ßÂìÅÈááË¥≠ÊàêÊú¨ÔºàÂê´ÂåÖË£ÖÊùêÊñôË¥πÁî®Ôºâ' },
                            { label: 'Â§¥Á®ãÊàêÊú¨ (Ôø•)', value: shippingCostCNY.toFixed(2), tooltip: 'Â§¥Á®ãÁâ©ÊµÅË¥πÁî®Ôºà‰∏≠ÂõΩÂà∞FBA‰ªìÂ∫ìÔºâ' },
                            { label: '‚òÖ ÊÄªÊàêÊú¨ (Ôø•) ‚òÖ', value: totalCostCNY.toFixed(2), tooltip: 'ÊÄªÊàêÊú¨ = ÈááË¥≠ÊàêÊú¨ + Â§¥Á®ãÁâ©ÊµÅ' },
                            { label: 'FBAÁâ©ÊµÅË¥π ($)', value: inputs.fbaFee.toFixed(2), tooltip: '‰∫öÈ©¨ÈÄäÊî∂ÂèñÁöÑÊú´Á´ØÈÖçÈÄÅË¥π' },
                            { label: '‰Ω£Èáë ($)', value: commission.toFixed(2), tooltip: '‰∫öÈ©¨ÈÄäÂπ≥Âè∞ÈîÄÂîÆ‰Ω£ÈáëÔºàÊåâÈîÄÂîÆÈ¢ùÊØî‰æãÔºâ' },
                            { label: '‰ªìÂÇ®Ë¥π ($)', value: inputs.storageFee.toFixed(2), tooltip: 'ÊúàÂ∫¶Â∫ìÂ≠ò‰ªìÂÇ®Ë¥πÁî®' },
                            { label: 'ÈÄÄË¥ßÊàêÊú¨ ($)', value: returnFee.toFixed(2), tooltip: 'È¢Ñ‰º∞ÈÄÄË¥ß‰∫ßÁîüÁöÑÂ§ÑÁêÜË¥πÁî®' }
                        ]
                    },
                    {
                        title: 'üíπ Âà©Ê∂¶ÂàÜÊûê',
                        items: [
                            { label: 'ÂáÄÂà©Ê∂¶Áéá', value: (profitRate * 100).toFixed(2) + '%', tooltip: 'ÔºàÂáÄÂà©Ê∂¶ / ÈîÄÂîÆÈ¢ùÔºâÁöÑÁôæÂàÜÊØî' },
                            { label: 'Âçï‰ª∂Âà©Ê∂¶ (Ôø•)', value: profitCNY.toFixed(2), tooltip: 'Âçï‰ª∂‰∫ßÂìÅ‰∫∫Ê∞ëÂ∏ÅÂáÄÂà©Ê∂¶' },
                            { label: 'Âçï‰ª∂Âà©Ê∂¶ ($)', value: profitUSD.toFixed(2), tooltip: 'Âçï‰ª∂‰∫ßÂìÅÁæéÂÖÉÂáÄÂà©Ê∂¶' },
                            { label: 'Âπ≥Âè∞ÂõûÊ¨æ (Ôø•)', value: platformRefundCNY.toFixed(2), tooltip: '‰∫öÈ©¨ÈÄäÂÆûÈôÖÁªìÁÆóÈáëÈ¢ùÔºà‰∫∫Ê∞ëÂ∏ÅÔºâ' },
                            { label: 'Âπ≥Âè∞ÂõûÊ¨æ ($)', value: platformRefund.toFixed(2), tooltip: '‰∫öÈ©¨ÈÄäÂÆûÈôÖÁªìÁÆóÈáëÈ¢ùÔºàÁæéÂÖÉÔºâ' },
                            { label: 'ÊúàÂà©Ê∂¶ (Ôø•‰∏á)', value: monthlyProfitCNY.toFixed(2), tooltip: 'È¢Ñ‰º∞ÊúàÂ∫¶ÊÄªÂà©Ê∂¶Ôºà‰∏áÂÖÉÔºâ' },
                            { label: 'Âπ¥Âà©Ê∂¶ (Ôø•‰∏á)', value: annualProfitCNY.toFixed(2), tooltip: 'È¢Ñ‰º∞Âπ¥Â∫¶ÊÄªÂà©Ê∂¶Ôºà‰∏áÂÖÉÔºâ' }
                        ]
                    },
                    {
                        title: 'üìä ÈîÄÂîÆË°®Áé∞',
                        items: [
                            { label: 'ÊúàÈîÄÈáè', value: inputs.monthlySales, tooltip: '‰∫ßÂìÅÊúàÂùáÈîÄÂîÆÊï∞Èáè' },
                            { label: 'ÈîÄÂîÆ‰ª∑Ê†º ($)', value: inputs.salesPrice.toFixed(2), tooltip: '‰∫ßÂìÅÂú®‰∫öÈ©¨ÈÄäÁöÑÈîÄÂîÆ‰ª∑Ê†º' },
                            { label: 'ÊúàÈîÄÂîÆÈ¢ù (Ôø•)', value: monthlyRevenueCNY.toFixed(2), tooltip: '‰∫∫Ê∞ëÂ∏ÅËÆ°ÁÆóÁöÑÊúàÈîÄÂîÆÈ¢ù' },
                            { label: 'ÊúàÈîÄÂîÆÈ¢ù ($)', value: monthlyRevenueUSD.toFixed(2), tooltip: 'ÁæéÂÖÉËÆ°ÁÆóÁöÑÊúàÈîÄÂîÆÈ¢ù' },
                            { label: 'Êó•ÂùáÈîÄÈáè', value: dailySales.toFixed(2), tooltip: 'Âπ≥ÂùáÊØèÊó•ÈîÄÂîÆÊï∞Èáè' },
                            { label: 'ÂπøÂëäÊîØÂá∫ ($)', value: adFee.toFixed(2), tooltip: 'ÂçïÁ¨îÂπøÂëäË¥πÊàêÊú¨' },
                            { label: 'ÂπøÂëäÂç†ÊØî (%)', value: (inputs.adRate * 100).toFixed(2) + '%', tooltip: 'ÂπøÂëäË¥πÂç†ÈîÄÂîÆÈ¢ùÊØî‰æã' },
                            { label: 'ÊêúÁ¥¢ËΩ¨ÂåñÁéá', value: (inputs.searchConversion * 100).toFixed(2) + '%', tooltip: 'ÊêúÁ¥¢ÊµÅÈáèËΩ¨Âåñ‰∏∫Ë¥≠‰π∞ÁöÑÊØî‰æã' },
                            { label: 'ÈÄÄË¥ßÁéá', value: (inputs.returnRate * 100).toFixed(2) + '%', tooltip: 'ËÆ¢ÂçïÈÄÄË¥ßÊØî‰æã' }
                        ]
                    },
                    {
                        title: 'üè¶ ËµÑÈáëÂàÜÊûê',
                        items: [
                            { label: 'ËµÑÈáëÂç†Áî® (Ôø•‰∏á)', value: capitalOccupiedCNY.toFixed(2), tooltip: 'ËøêËê•ÊâÄÈúÄÊµÅÂä®ËµÑÈáëËßÑÊ®°' },
                            { label: 'ÂéãË¥ßÊàêÊú¨ (Ôø•‰∏á)', value: stockCostCNY.toFixed(2), tooltip: 'Â∫ìÂ≠òÂç†Áî®ÁöÑËµÑÈáëÊàêÊú¨' },
                            { label: 'ÂéãË¥ßÊï∞Èáè', value: stockQuantity.toFixed(2), tooltip: 'ÈúÄË¶ÅÁª¥ÊåÅÁöÑÂ∫ìÂ≠òÊï∞Èáè' },
                            { label: 'ÂéãË¥ßÂ§©Êï∞', value: inputs.stockDays, tooltip: 'Â∫ìÂ≠òÂë®ËΩ¨Â§©Êï∞' },
                            { label: 'Áé∞ÈáëÂë®Êúü (Â§©)', value: cashCycle.toFixed(2), tooltip: 'ËµÑÈáëÂë®ËΩ¨ÂÆåÊï¥Âë®ÊúüÂ§©Êï∞' },
                            { label: 'Ë¥¶ÊúüÂ§©Êï∞', value: inputs.accountPeriod || 'Êú™ËÆæÁΩÆ', tooltip: '‰æõÂ∫îÂïÜË¥¶ÊúüÂ§©Êï∞' },
                            { label: 'ÊàêÊú¨ÂõûÊä•Áéá', value: (costReturnRatio * 100).toFixed(2) + '%', tooltip: 'Âà©Ê∂¶‰∏éÊÄªÊàêÊú¨ÁöÑÊØî‰æã' },
                            { label: 'Âπ¥ÂõûÊä•Áéá (%)', value: (annualROI * 100).toFixed(2) + '%', tooltip: 'Âπ¥Â∫¶ÊäïËµÑÂõûÊä•Áéá' },
                            { label: 'ÂõûÊú¨Âë®Êúü (Â§©)', value: paybackDays.toFixed(2), tooltip: 'Êî∂ÂõûÂàùÂßãÊäïËµÑÊâÄÈúÄÂ§©Êï∞' }
                        ]
                    }
                ];

                const resultsContainer = document.getElementById('results');
                resultsContainer.innerHTML = '';
                resultCards.forEach(card => {
                    const cardHTML = `
                        <div class="result-card">
                            <h3>${card.title}</h3>
                            ${card.items.map(item => `
                                <div class="result-item">
                                    <span class="label">${item.label}</span>
                                    <span class="value">
                                        ${item.value}
                                        ${item.tooltip ? `<span class="tooltip">${item.tooltip}</span>` : ''}
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    resultsContainer.innerHTML += cardHTML;
                });

                updateDashboard({
                    profitRate,
                    annualROI,
                    monthlyProfitCNY,
                    paybackDays,
                    monthlyRevenueCNY,
                    totalCostCNY,
                    capitalOccupiedCNY,
                    costReturnRatio,
                    cashCycle
                });

            } catch (error) {
                console.error("ËÆ°ÁÆóÈîôËØØ:", error);
            }
        }

                function updateDashboard(metrics) {
            try {
                const dashboard = document.getElementById('dashboard');
                
                dashboard.innerHTML = `
<div class="metric-card">
    <h4 class="metric-title">üìà Ê†∏ÂøÉÂà©Ê∂¶Áéá</h4>
    <div class="metric-value">
        ${(metrics.profitRate * 100).toFixed(1)}
        <span class="value-unit">%</span>
    </div>
    <div class="donut-chart" 
        style="--fill-color: #3b82f6; --fill-percent: ${metrics.profitRate * 100}%">
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">üöÄ Âπ¥ÂåñÂõûÊä•Áéá</h4>
    <div class="metric-value">
        ${(metrics.annualROI * 100).toFixed(1)}
        <span class="value-unit">%</span>
        <div class="trend-indicator ${metrics.annualROI > 0.3 ? 'trend-up' : 'trend-down'}">
            ${metrics.annualROI > 0.3 ? 'üìà ÂÅ•Â∫∑' : 'üìâ È¢ÑË≠¶'}
        </div>
    </div>
    <div class="mini-chart">
        <div class="mini-bars">
            ${[metrics.profitRate, metrics.annualROI, metrics.costReturnRatio]
                .map(rate => 
                    `<div class="mini-bar" 
                        style="height: ${Math.min(rate * 200, 100)}%;
                               background: #3b82f6">
                    </div>`
                ).join('')}
        </div>
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">üí∞ ÊúàÂà©Ê∂¶ËßÑÊ®°</h4>
    <div class="metric-value">
        ${metrics.monthlyProfitCNY.toFixed(1)}
        <span class="value-unit">‰∏áÂÖÉ</span>
    </div>
    <div class="mini-chart">
        <div style="background: #e2e8f0; height: 6px; border-radius: 3px;">
            <div style="width: ${Math.min(metrics.monthlyProfitCNY / 50 * 100, 100)}%; 
                        height: 100%; 
                        background: linear-gradient(90deg, #3b82f6 0%, #6366f1 100%); 
                        border-radius: 3px;">
            </div>
        </div>
        <div style="margin-top:12px; color: #64748b; font-size:13px;">
            ‚ñ≤ Ë°å‰∏öÊ†áÊùÜ ${(50).toFixed(1)}‰∏áÂÖÉ
        </div>
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">‚è≥ ÂõûÊú¨Âë®Êúü</h4>
    <div class="metric-value">
        ${metrics.paybackDays.toFixed(0)}
        <span class="value-unit">Â§©</span>
        <div class="trend-indicator ${metrics.paybackDays < 180 ? 'trend-up' : 'trend-down'}">
            ${metrics.paybackDays < 180 ? '‚è±Ô∏è ‰ºòÁßÄ' : '‚ö†Ô∏è Ê≥®ÊÑè'}
        </div>
    </div>
    <div class="mini-chart">
        <div class="mini-bars">
            ${[30, 90, 180].map(d => 
                `<div class="mini-bar" 
                    style="height: ${100 - (metrics.paybackDays / d * 100)}%;
                           background: ${metrics.paybackDays <= d ? '#10b981' : '#f59e0b'}">
                </div>`
            ).join('')}
        </div>
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">üìä ÊàêÊú¨ÂõûÊä•Áéá</h4>
    <div class="metric-value">
        ${(metrics.costReturnRatio * 100).toFixed(1)}
        <span class="value-unit">%</span>
    </div>
    <div class="donut-chart" 
        style="--fill-color: #f59e0b; --fill-percent: ${metrics.costReturnRatio * 100}%">
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">‚è±Ô∏è Áé∞ÈáëÂë®Êúü</h4>
    <div class="metric-value">
        ${metrics.cashCycle.toFixed(0)}
        <span class="value-unit">Â§©</span>
    </div>
    <div class="mini-chart">
        <div style="background: #e2e8f0; height: 6px; border-radius: 3px;">
            <div style="width: ${Math.min(metrics.cashCycle / 90 * 100, 100)}%; 
                        height: 100%; 
                        background: linear-gradient(90deg, #10b981 0%, #3b82f6 100%); 
                        border-radius: 3px;">
            </div>
        </div>
        <div style="margin-top:12px; color: #64748b; font-size:13px;">
            ‚ñ≤ ÁêÜÊÉ≥Âë®Êúü ‚â§45Â§©
        </div>
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">üìä ÈîÄÂîÆÈ¢ùÊûÑÊàê</h4>
    <div class="metric-value">${(metrics.monthlyRevenueCNY/10000).toFixed(1)}<span class="value-unit">‰∏áÂÖÉ</span></div>
    <div class="mini-chart">
        <div style="display: flex; gap: 15px; font-size: 12px;">
            <div style="color: #3b82f6">‚óè ÈîÄÂîÆÈ¢ù</div>
            <div style="color: #94a3b8">‚óè ÊàêÊú¨ ${metrics.totalCostCNY.toFixed(1)}ÂÖÉ</div>
        </div>
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">üîÑ ËµÑÈáëÊïàÁéá</h4>
    <div class="metric-value">${metrics.capitalOccupiedCNY.toFixed(1)}<span class="value-unit">‰∏áÂÖÉ</span></div>
    <div class="mini-chart">
        <div style="font-size: 13px; color: #64748b">
            ‚ö° Âë®ËΩ¨Áéá ${(1/metrics.costReturnRatio).toFixed(1)}Ê¨°/Âπ¥
        </div>
    </div>
</div>
                `;
            } catch (error) {
                console.error("‰ª™Ë°®ÁõòÊ∏≤ÊüìÈîôËØØ:", error);
            }
        }

        function saveAsHTML() {
            try {
                const inputs = {};
                document.querySelectorAll('input, select').forEach(element => {
                    inputs[element.id] = element.value;
                });

                const template = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${document.getElementById('productName').value || '‰∫öÈ©¨ÈÄäÂàÜÊûêÊä•Âëä'}</title>
    <style>${document.querySelector('style').innerHTML}</style>
</head>
<body>
    <div class="container">${document.querySelector('.container').innerHTML}</div>
    <script>
        ${calculate.toString()}
        ${updateDashboard.toString()}

        const SAVED_STATE = {
            inputs: ${JSON.stringify(inputs)},
            results: {
                html: ${JSON.stringify(document.getElementById('results').innerHTML)},
                dashboard: ${JSON.stringify(document.getElementById('dashboard').innerHTML)}
            }
        };

        document.querySelectorAll('input, select').forEach(el => {
            el.value = SAVED_STATE.inputs[el.id] || '';
        });
        
        document.getElementById('results').innerHTML = SAVED_STATE.results.html;
        document.getElementById('dashboard').innerHTML = SAVED_STATE.results.dashboard;

        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('input', calculate);
        });

        document.querySelector('.export-btn').onclick = ${saveAsHTML.toString()};
    <\/script>
</body>
</html>`;

                const productName = document.getElementById('productName').value.replace(/[^\w\u4e00-\u9fa5]/g, '') || 'analysis';
                const dateStr = new Date().toISOString().split('T')[0];
                const blob = new Blob([template], {type: 'text/html'});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${productName}_${dateStr}.html`;
                link.click();
            } catch (error) {
                console.error('‰øùÂ≠òÂ§±Ë¥•:', error);
                alert('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞');
            }
        }

        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('input', calculate);
        });
        calculate();
    </script>
</body>
</html>