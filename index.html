<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºšé©¬é€Šè¿è¥åˆ†æè®¡ç®—å™¨</title>
    <style>
        :root { 
            --primary-color: #2c3e50; 
            --secondary-color: #3b82f6; 
            --success-color: #10b981; 
        }
        body { 
            font-family: 'Segoe UI', system-ui; 
            background: #f8f9fa; 
            margin: 0; 
            padding: 20px; 
        }
        .container { 
            max-width: 1400px;
            margin: 20px auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            position: relative;
        }
        h1 {
            flex: 1;
            text-align: center;
            color: var(--primary-color);
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 15px;
            margin: 0 20px;
        }
        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .export-btn {
            background: var(--secondary-color);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .export-btn:hover {
            opacity: 0.9;
        }
        .input-section { 
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        @media (max-width: 1200px) {
            .input-section { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 768px) {
            .input-section { grid-template-columns: 1fr; }
        }
        .input-group { 
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-color);
            min-width: 0;
        }
        #productInfo label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }
        #productInfo input {
            width: 100%;
            margin-top: 8px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
            color: #666;
        }
        .input-group:not(#productInfo) > label { 
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 14px;
        }
        .input-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 8px;
        }
        .input-label {
            font-size: 13px;
            color: var(--primary-color);
            white-space: nowrap;
            margin-right: 10px;
        }
        .input-group:not(#productInfo) input, 
        .input-group:not(#productInfo) select { 
            width: 120px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
        }
        .results-container { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .result-card { 
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-top: 4px solid var(--secondary-color);
            min-height: 300px;
        }
        .result-card h3 { 
            color: var(--primary-color);
            margin: 0 0 15px 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .result-item { 
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .result-item:last-child { border-bottom: none; }
        .label { 
            color: #7f8c8d;
            font-weight: 500;
            min-width: 160px;
        }
        .value { 
            color: var(--primary-color);
            font-weight: 600;
            text-align: right;
            position: relative;
            cursor: help;
        }
        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s;
            pointer-events: none;
            font-weight: 400;
            line-height: 1.4;
            max-width: 220px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .value:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
                .metric-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafe 100%);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(238, 242, 247, 0.8);
            position: relative;
            overflow: hidden;
        }
        .metric-card::before {
            content: "";
            position: absolute;
            top: -50px;
            right: -50px;
            width: 100px;
            height: 100px;
            background: rgba(52, 152, 219, 0.08);
            border-radius: 50%;
        }
        .metric-title {
            color: #64748b;
            font-size: 14px;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .metric-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: baseline;
            gap: 8px;
        }
        .value-unit {
            font-size: 16px;
            color: #94a3b8;
            font-weight: 500;
        }
        .trend-indicator {
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
        }
        .trend-up { color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .trend-down { color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        .mini-chart {
            height: 80px;
            margin: 15px -25px -25px;
            position: relative;
        }
        .donut-chart {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(var(--fill-color) 0% var(--fill-percent), #e2e8f0 0);
        }
        .donut-inner {
            position: absolute;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            top: 10px;
            left: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--primary-color);
        }
        .mini-bars {
            display: flex;
            align-items: flex-end;
            height: 100%;
            gap: 8px;
            padding: 0 15px;
        }
        .mini-bar {
            width: 20px;
            background: var(--secondary-color);
            border-radius: 4px 4px 0 0;
            transition: height 0.3s ease;
        }
        input {
            background: white !important;
            color: #666 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-container">
            <div class="header-controls">
                <div class="exchange-rate-group">
                    <span class="exchange-rate-label">ğŸ’° æ±‡ç‡ (CNY/USD):</span>
                    <input type="number" id="exchangeRate" value="7" step="0.01" required>
                </div>
                <button class="export-btn" onclick="saveAsHTML()">ä¿å­˜</button>
            </div>
            <div style="display: flex; align-items: center; gap: 15px; justify-content: center; flex: 1;">
                <h1>äºšé©¬é€ŠæŠ•äº§æ¯”åˆ†æè®¡ç®—å™¨</h1>
                <img src="https://raw.githubusercontent.com/qssw-01/Amazon-Productivity-Calculator/refs/heads/main/amazon.png" 
                     style="height: 40px; width: auto; margin-bottom: 8px;">
            </div>
        </div>

        <div class="input-section">
            <div class="input-group" id="productInfo">
                <label>ğŸ“¦ äº§å“ä¿¡æ¯</label>
                <input type="text" id="productName" placeholder="äº§å“åç§°">
                <input type="text" id="amazonLink" placeholder="äºšé©¬é€Šé“¾æ¥">
                <input type="text" id="link1688" placeholder="1688é“¾æ¥">
            </div>

            <div class="input-group">
                <label>ğŸ“ˆ é”€å”®æ•°æ®</label>
                <div class="input-row">
                    <span class="input-label">æœˆé”€é‡</span>
                    <input type="number" id="monthlySales" value="600" required>
                </div>
                <div class="input-row">
                    <span class="input-label">æœç´¢è½¬åŒ–ç‡ (%)</span>
                    <input type="number" id="searchConversion" value="5" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">é€€è´§ç‡ (%)</span>
                    <input type="number" id="returnRate" value="1.8" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">é”€å”®ä»·æ ¼ ($)</span>
                    <input type="number" id="salesPrice" value="35" step="0.1" required>
                </div>
            </div>

            <div class="input-group">
                <label>ğŸ§® æˆæœ¬è®¡ç®—</label>
                <div class="input-row">
                    <span class="input-label">é‡‡è´­æˆæœ¬ (ï¿¥)</span>
                    <input type="number" id="purchaseCostCNY" value="65" required>
                </div>
                <div class="input-row">
                    <span class="input-label">äº§å“é‡é‡ (kg)</span>
                    <input type="number" id="weight" value="1.3" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">ç‰©æµæ–¹å¼</span>
                    <select id="shippingMethod">
                        <option value="ç©ºè¿">ç©ºè¿</option>
                        <option value="æµ·è¿" selected>æµ·è¿</option>
                    </select>
                </div>
                <div class="input-row">
                    <span class="input-label">ç‰©æµå•ä»· (ï¿¥/kg)</span>
                    <input type="number" id="shippingPrice" value="7" required>
                </div>
            </div>
                        <div class="input-group">
                <label>âš™ï¸ è´¹ç”¨è®¾ç½®</label>
                <div class="input-row">
                    <span class="input-label">FBAç‰©æµè´¹ ($)</span>
                    <input type="number" id="fbaFee" value="7.03" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">ä½£é‡‘ (%)</span>
                    <input type="number" id="commission" value="15" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">é…ç½®è´¹ ($)</span>
                    <input type="number" id="configFee" value="0.34" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">ä»“å‚¨è´¹ ($)</span>
                    <input type="number" id="storageFee" value="0.55" step="0.1" required>
                </div>
            </div>

            <div class="input-group">
                <label>ğŸ¦ èµ„é‡‘è®¾ç½®</label>
                <div class="input-row">
                    <span class="input-label">å¹¿å‘Šå æ¯” (%)</span>
                    <input type="number" id="adRate" value="10" step="0.1" required>
                </div>
                <div class="input-row">
                    <span class="input-label">å‹è´§å¤©æ•°</span>
                    <input type="number" id="stockDays" value="120" required>
                </div>
                <div class="input-row">
                    <span class="input-label">è´¦æœŸå¤©æ•°</span>
                    <input type="number" id="accountPeriod" value="">
                </div>
                <div class="input-row">
                    <span class="input-label">æç°å‘¨æœŸ</span>
                    <input type="number" id="withdrawPeriod" value="15">
                </div>
            </div>
        </div>

        <div class="results-container" id="results"></div>
        <div class="dashboard" id="dashboard"></div>
    </div>
        <script>
        function calculate() {
            try {
                const getValue = id => parseFloat(document.getElementById(id).value) || 0;
                
                const inputs = {
                    exchangeRate: getValue('exchangeRate'),
                    monthlySales: getValue('monthlySales'),
                    searchConversion: getValue('searchConversion') / 100,
                    returnRate: getValue('returnRate') / 100,
                    salesPrice: getValue('salesPrice'),
                    purchaseCostCNY: getValue('purchaseCostCNY'),
                    weight: getValue('weight'),
                    shippingPrice: getValue('shippingPrice'),
                    fbaFee: getValue('fbaFee'),
                    commission: getValue('commission') / 100,
                    configFee: getValue('configFee'),
                    storageFee: getValue('storageFee'),
                    adRate: getValue('adRate') / 100,
                    stockDays: getValue('stockDays'),
                    accountPeriod: getValue('accountPeriod'),
                    withdrawPeriod: getValue('withdrawPeriod')
                };

                const shippingCostCNY = inputs.weight * inputs.shippingPrice;
                const purchaseCostUSD = inputs.purchaseCostCNY / inputs.exchangeRate;
                const shippingCostUSD = shippingCostCNY / inputs.exchangeRate;
                const commission = inputs.salesPrice * inputs.commission;
                const returnFee = inputs.salesPrice * inputs.returnRate;
                const adFee = inputs.salesPrice * inputs.adRate;

                const platformRefund = inputs.salesPrice - commission - inputs.configFee 
                    - inputs.storageFee - returnFee - adFee - inputs.fbaFee;
                const platformRefundCNY = platformRefund * inputs.exchangeRate;
                const profitUSD = platformRefund - purchaseCostUSD - shippingCostUSD;
                const profitCNY = profitUSD * inputs.exchangeRate;
                const profitRate = profitUSD / inputs.salesPrice;

                const monthlyRevenueUSD = inputs.monthlySales * inputs.salesPrice;
                const monthlyRevenueCNY = monthlyRevenueUSD * inputs.exchangeRate;
                const monthlyProfitCNY = (profitCNY * inputs.monthlySales) / 10000;
                const annualProfitCNY = monthlyProfitCNY * 12;

                const totalCostCNY = inputs.purchaseCostCNY + shippingCostCNY;
                const costReturnRatio = profitCNY / totalCostCNY;
                const dailySales = inputs.monthlySales / 30;
                const stockQuantity = dailySales * inputs.stockDays;
                const stockCostCNY = (stockQuantity * totalCostCNY) / 10000;
                const cashCycle = inputs.stockDays - (inputs.accountPeriod || 0) + (inputs.withdrawPeriod || 0);
                const capitalOccupiedCNY = (cashCycle * dailySales * totalCostCNY) / 10000;
                const annualROI = annualProfitCNY / capitalOccupiedCNY;
                const paybackDays = (stockCostCNY / annualProfitCNY) * 365;

                const resultCards = [
                    {
                        title: 'ğŸ“¦ æˆæœ¬æ˜ç»†',
                        items: [
                            { label: 'é‡‡è´­æˆæœ¬ (ï¿¥)', value: inputs.purchaseCostCNY.toFixed(2), tooltip: 'äº§å“é‡‡è´­æˆæœ¬ï¼ˆå«åŒ…è£…ææ–™è´¹ç”¨ï¼‰' },
                            { label: 'å¤´ç¨‹æˆæœ¬ (ï¿¥)', value: shippingCostCNY.toFixed(2), tooltip: 'å¤´ç¨‹ç‰©æµè´¹ç”¨ï¼ˆä¸­å›½åˆ°FBAä»“åº“ï¼‰' },
                            { label: 'â˜… æ€»æˆæœ¬ (ï¿¥) â˜…', value: totalCostCNY.toFixed(2), tooltip: 'æ€»æˆæœ¬ = é‡‡è´­æˆæœ¬ + å¤´ç¨‹ç‰©æµ' },
                            { label: 'FBAç‰©æµè´¹ ($)', value: inputs.fbaFee.toFixed(2), tooltip: 'äºšé©¬é€Šæ”¶å–çš„æœ«ç«¯é…é€è´¹' },
                            { label: 'ä½£é‡‘ ($)', value: commission.toFixed(2), tooltip: 'äºšé©¬é€Šå¹³å°é”€å”®ä½£é‡‘ï¼ˆæŒ‰é”€å”®é¢æ¯”ä¾‹ï¼‰' },
                            { label: 'ä»“å‚¨è´¹ ($)', value: inputs.storageFee.toFixed(2), tooltip: 'æœˆåº¦åº“å­˜ä»“å‚¨è´¹ç”¨' },
                            { label: 'é€€è´§æˆæœ¬ ($)', value: returnFee.toFixed(2), tooltip: 'é¢„ä¼°é€€è´§äº§ç”Ÿçš„å¤„ç†è´¹ç”¨' }
                        ]
                    },
                    {
                        title: 'ğŸ’¹ åˆ©æ¶¦åˆ†æ',
                        items: [
                            { label: 'å‡€åˆ©æ¶¦ç‡', value: (profitRate * 100).toFixed(2) + '%', tooltip: 'ï¼ˆå‡€åˆ©æ¶¦ / é”€å”®é¢ï¼‰çš„ç™¾åˆ†æ¯”' },
                            { label: 'å•ä»¶åˆ©æ¶¦ (ï¿¥)', value: profitCNY.toFixed(2), tooltip: 'å•ä»¶äº§å“äººæ°‘å¸å‡€åˆ©æ¶¦' },
                            { label: 'å•ä»¶åˆ©æ¶¦ ($)', value: profitUSD.toFixed(2), tooltip: 'å•ä»¶äº§å“ç¾å…ƒå‡€åˆ©æ¶¦' },
                            { label: 'å¹³å°å›æ¬¾ (ï¿¥)', value: platformRefundCNY.toFixed(2), tooltip: 'äºšé©¬é€Šå®é™…ç»“ç®—é‡‘é¢ï¼ˆäººæ°‘å¸ï¼‰' },
                            { label: 'å¹³å°å›æ¬¾ ($)', value: platformRefund.toFixed(2), tooltip: 'äºšé©¬é€Šå®é™…ç»“ç®—é‡‘é¢ï¼ˆç¾å…ƒï¼‰' },
                            { label: 'æœˆåˆ©æ¶¦ (ï¿¥ä¸‡)', value: monthlyProfitCNY.toFixed(2), tooltip: 'é¢„ä¼°æœˆåº¦æ€»åˆ©æ¶¦ï¼ˆä¸‡å…ƒï¼‰' },
                            { label: 'å¹´åˆ©æ¶¦ (ï¿¥ä¸‡)', value: annualProfitCNY.toFixed(2), tooltip: 'é¢„ä¼°å¹´åº¦æ€»åˆ©æ¶¦ï¼ˆä¸‡å…ƒï¼‰' }
                        ]
                    },
                    {
                        title: 'ğŸ“Š é”€å”®è¡¨ç°',
                        items: [
                            { label: 'æœˆé”€é‡', value: inputs.monthlySales, tooltip: 'äº§å“æœˆå‡é”€å”®æ•°é‡' },
                            { label: 'é”€å”®ä»·æ ¼ ($)', value: inputs.salesPrice.toFixed(2), tooltip: 'äº§å“åœ¨äºšé©¬é€Šçš„é”€å”®ä»·æ ¼' },
                            { label: 'æœˆé”€å”®é¢ (ï¿¥)', value: monthlyRevenueCNY.toFixed(2), tooltip: 'äººæ°‘å¸è®¡ç®—çš„æœˆé”€å”®é¢' },
                            { label: 'æœˆé”€å”®é¢ ($)', value: monthlyRevenueUSD.toFixed(2), tooltip: 'ç¾å…ƒè®¡ç®—çš„æœˆé”€å”®é¢' },
                            { label: 'æ—¥å‡é”€é‡', value: dailySales.toFixed(2), tooltip: 'å¹³å‡æ¯æ—¥é”€å”®æ•°é‡' },
                            { label: 'å¹¿å‘Šæ”¯å‡º ($)', value: adFee.toFixed(2), tooltip: 'å•ç¬”å¹¿å‘Šè´¹æˆæœ¬' },
                            { label: 'å¹¿å‘Šå æ¯” (%)', value: (inputs.adRate * 100).toFixed(2) + '%', tooltip: 'å¹¿å‘Šè´¹å é”€å”®é¢æ¯”ä¾‹' },
                            { label: 'æœç´¢è½¬åŒ–ç‡', value: (inputs.searchConversion * 100).toFixed(2) + '%', tooltip: 'æœç´¢æµé‡è½¬åŒ–ä¸ºè´­ä¹°çš„æ¯”ä¾‹' },
                            { label: 'é€€è´§ç‡', value: (inputs.returnRate * 100).toFixed(2) + '%', tooltip: 'è®¢å•é€€è´§æ¯”ä¾‹' }
                        ]
                    },
                    {
                        title: 'ğŸ¦ èµ„é‡‘åˆ†æ',
                        items: [
                            { label: 'èµ„é‡‘å ç”¨ (ï¿¥ä¸‡)', value: capitalOccupiedCNY.toFixed(2), tooltip: 'è¿è¥æ‰€éœ€æµåŠ¨èµ„é‡‘è§„æ¨¡' },
                            { label: 'å‹è´§æˆæœ¬ (ï¿¥ä¸‡)', value: stockCostCNY.toFixed(2), tooltip: 'åº“å­˜å ç”¨çš„èµ„é‡‘æˆæœ¬' },
                            { label: 'å‹è´§æ•°é‡', value: stockQuantity.toFixed(2), tooltip: 'éœ€è¦ç»´æŒçš„åº“å­˜æ•°é‡' },
                            { label: 'å‹è´§å¤©æ•°', value: inputs.stockDays, tooltip: 'åº“å­˜å‘¨è½¬å¤©æ•°' },
                            { label: 'ç°é‡‘å‘¨æœŸ (å¤©)', value: cashCycle.toFixed(2), tooltip: 'èµ„é‡‘å‘¨è½¬å®Œæ•´å‘¨æœŸå¤©æ•°' },
                            { label: 'è´¦æœŸå¤©æ•°', value: inputs.accountPeriod || 'æœªè®¾ç½®', tooltip: 'ä¾›åº”å•†è´¦æœŸå¤©æ•°' },
                            { label: 'æˆæœ¬å›æŠ¥ç‡', value: (costReturnRatio * 100).toFixed(2) + '%', tooltip: 'åˆ©æ¶¦ä¸æ€»æˆæœ¬çš„æ¯”ä¾‹' },
                            { label: 'å¹´å›æŠ¥ç‡ (%)', value: (annualROI * 100).toFixed(2) + '%', tooltip: 'å¹´åº¦æŠ•èµ„å›æŠ¥ç‡' },
                            { label: 'å›æœ¬å‘¨æœŸ (å¤©)', value: paybackDays.toFixed(2), tooltip: 'æ”¶å›åˆå§‹æŠ•èµ„æ‰€éœ€å¤©æ•°' }
                        ]
                    }
                ];

                const resultsContainer = document.getElementById('results');
                resultsContainer.innerHTML = '';
                resultCards.forEach(card => {
                    const cardHTML = `
                        <div class="result-card">
                            <h3>${card.title}</h3>
                            ${card.items.map(item => `
                                <div class="result-item">
                                    <span class="label">${item.label}</span>
                                    <span class="value">
                                        ${item.value}
                                        ${item.tooltip ? `<span class="tooltip">${item.tooltip}</span>` : ''}
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    resultsContainer.innerHTML += cardHTML;
                });

                updateDashboard({
                    profitRate,
                    annualROI,
                    monthlyProfitCNY,
                    paybackDays,
                    monthlyRevenueCNY,
                    totalCostCNY,
                    capitalOccupiedCNY,
                    costReturnRatio,
                    cashCycle
                });

            } catch (error) {
                console.error("è®¡ç®—é”™è¯¯:", error);
            }
        }

                function updateDashboard(metrics) {
            try {
                const dashboard = document.getElementById('dashboard');
                
                dashboard.innerHTML = `
<div class="metric-card">
    <h4 class="metric-title">ğŸ“ˆ æ ¸å¿ƒåˆ©æ¶¦ç‡</h4>
    <div class="metric-value">
        ${(metrics.profitRate * 100).toFixed(1)}
        <span class="value-unit">%</span>
    </div>
    <div class="donut-chart" 
        style="--fill-color: #3b82f6; --fill-percent: ${metrics.profitRate * 100}%">
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">ğŸš€ å¹´åŒ–å›æŠ¥ç‡</h4>
    <div class="metric-value">
        ${(metrics.annualROI * 100).toFixed(1)}
        <span class="value-unit">%</span>
        <div class="trend-indicator ${metrics.annualROI > 0.3 ? 'trend-up' : 'trend-down'}">
            ${metrics.annualROI > 0.3 ? 'ğŸ“ˆ å¥åº·' : 'ğŸ“‰ é¢„è­¦'}
        </div>
    </div>
    <div class="mini-chart">
        <div class="mini-bars">
            ${[metrics.profitRate, metrics.annualROI, metrics.costReturnRatio]
                .map(rate => 
                    `<div class="mini-bar" 
                        style="height: ${Math.min(rate * 200, 100)}%;
                               background: #3b82f6">
                    </div>`
                ).join('')}
        </div>
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">ğŸ’° æœˆåˆ©æ¶¦è§„æ¨¡</h4>
    <div class="metric-value">
        ${metrics.monthlyProfitCNY.toFixed(1)}
        <span class="value-unit">ä¸‡å…ƒ</span>
    </div>
    <div class="mini-chart">
        <div style="background: #e2e8f0; height: 6px; border-radius: 3px;">
            <div style="width: ${Math.min(metrics.monthlyProfitCNY / 50 * 100, 100)}%; 
                        height: 100%; 
                        background: linear-gradient(90deg, #3b82f6 0%, #6366f1 100%); 
                        border-radius: 3px;">
            </div>
        </div>
        <div style="margin-top:12px; color: #64748b; font-size:13px;">
            â–² è¡Œä¸šæ ‡æ† ${(50).toFixed(1)}ä¸‡å…ƒ
        </div>
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">â³ å›æœ¬å‘¨æœŸ</h4>
    <div class="metric-value">
        ${metrics.paybackDays.toFixed(0)}
        <span class="value-unit">å¤©</span>
        <div class="trend-indicator ${metrics.paybackDays < 180 ? 'trend-up' : 'trend-down'}">
            ${metrics.paybackDays < 180 ? 'â±ï¸ ä¼˜ç§€' : 'âš ï¸ æ³¨æ„'}
        </div>
    </div>
    <div class="mini-chart">
        <div class="mini-bars">
            ${[30, 90, 180].map(d => 
                `<div class="mini-bar" 
                    style="height: ${100 - (metrics.paybackDays / d * 100)}%;
                           background: ${metrics.paybackDays <= d ? '#10b981' : '#f59e0b'}">
                </div>`
            ).join('')}
        </div>
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">ğŸ“Š æˆæœ¬å›æŠ¥ç‡</h4>
    <div class="metric-value">
        ${(metrics.costReturnRatio * 100).toFixed(1)}
        <span class="value-unit">%</span>
    </div>
    <div class="donut-chart" 
        style="--fill-color: #f59e0b; --fill-percent: ${metrics.costReturnRatio * 100}%">
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">â±ï¸ ç°é‡‘å‘¨æœŸ</h4>
    <div class="metric-value">
        ${metrics.cashCycle.toFixed(0)}
        <span class="value-unit">å¤©</span>
    </div>
    <div class="mini-chart">
        <div style="background: #e2e8f0; height: 6px; border-radius: 3px;">
            <div style="width: ${Math.min(metrics.cashCycle / 90 * 100, 100)}%; 
                        height: 100%; 
                        background: linear-gradient(90deg, #10b981 0%, #3b82f6 100%); 
                        border-radius: 3px;">
            </div>
        </div>
        <div style="margin-top:12px; color: #64748b; font-size:13px;">
            â–² ç†æƒ³å‘¨æœŸ â‰¤45å¤©
        </div>
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">ğŸ“Š é”€å”®é¢æ„æˆ</h4>
    <div class="metric-value">${(metrics.monthlyRevenueCNY/10000).toFixed(1)}<span class="value-unit">ä¸‡å…ƒ</span></div>
    <div class="mini-chart">
        <div style="display: flex; gap: 15px; font-size: 12px;">
            <div style="color: #3b82f6">â— é”€å”®é¢</div>
            <div style="color: #94a3b8">â— æˆæœ¬ ${metrics.totalCostCNY.toFixed(1)}å…ƒ</div>
        </div>
    </div>
</div>

<div class="metric-card">
    <h4 class="metric-title">ğŸ”„ èµ„é‡‘æ•ˆç‡</h4>
    <div class="metric-value">${metrics.capitalOccupiedCNY.toFixed(1)}<span class="value-unit">ä¸‡å…ƒ</span></div>
    <div class="mini-chart">
        <div style="font-size: 13px; color: #64748b">
            âš¡ å‘¨è½¬ç‡ ${(1/metrics.costReturnRatio).toFixed(1)}æ¬¡/å¹´
        </div>
    </div>
</div>
                `;
            } catch (error) {
                console.error("ä»ªè¡¨ç›˜æ¸²æŸ“é”™è¯¯:", error);
            }
        }

        function saveAsHTML() {
            try {
                const inputs = {};
                document.querySelectorAll('input, select').forEach(element => {
                    inputs[element.id] = element.value;
                });

                const template = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${document.getElementById('productName').value || 'äºšé©¬é€Šåˆ†ææŠ¥å‘Š'}</title>
    <style>${document.querySelector('style').innerHTML}</style>
</head>
<body>
    <div class="container">${document.querySelector('.container').innerHTML}</div>
    <script>
        ${calculate.toString()}
        ${updateDashboard.toString()}

        const SAVED_STATE = {
            inputs: ${JSON.stringify(inputs)},
            results: {
                html: ${JSON.stringify(document.getElementById('results').innerHTML)},
                dashboard: ${JSON.stringify(document.getElementById('dashboard').innerHTML)}
            }
        };

        document.querySelectorAll('input, select').forEach(el => {
            el.value = SAVED_STATE.inputs[el.id] || '';
        });
        
        document.getElementById('results').innerHTML = SAVED_STATE.results.html;
        document.getElementById('dashboard').innerHTML = SAVED_STATE.results.dashboard;

        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('input', calculate);
        });

        document.querySelector('.export-btn').onclick = ${saveAsHTML.toString()};
    <\/script>
</body>
</html>`;

                const productName = document.getElementById('productName').value.replace(/[^\w\u4e00-\u9fa5]/g, '') || 'analysis';
                const dateStr = new Date().toISOString().split('T')[0];
                const blob = new Blob([template], {type: 'text/html'});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${productName}_${dateStr}.html`;
                link.click();
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°');
            }
        }

        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('input', calculate);
        });
        calculate();
    </script>
</body>
</html>